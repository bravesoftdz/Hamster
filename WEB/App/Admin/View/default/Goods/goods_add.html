<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

    <head>
        <include file="public:header" />
        <link href="__CSS__/page-min.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.config.js"></script>
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.all.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/lang/zh-cn/zh-cn.js"></script>
    </head>

    <body>
        <div class="container">
            <div class="clear">
                <button class="button button-default" onclick="javascript :history.back(-1)">返回</button>
                <button type="button" id="submit" class="button button-primary">保存商品</button>
            </div>
            <br/>
            <div class="row">
                <div id="tab"></div>
                <form action="{:u('Goods/goods_save')}" class="form-horizontal" method="post" id="goods_add">
                    <input type="hidden" name="id" value="{$item['id']}" />
                    <div id="panel" class="">
                        <div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>淘宝商品URL：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoid" name="auctionUrl" id="url" value="{$item['auctionUrl']}" />
                                    <span class="button button-success get_item" id="btnGet">采集商品信息</span>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品库分类：</label>
                                <div class="controls">
                                    <select name="cate_id" class="input-normal bui-form-field-select bui-form-field bui-form-field-select-hover bui-form-field-hover bui-form-field-error" aria-disabled="false" aria-pressed="false">
                                        <option value="0">--请选择--</option>
                                        <foreach name="cateList" item="itemc">
                                            <option value="{$itemc.id}">{$itemc.name}</option>
                                        </foreach>
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品分类：</label>
                                <div class="controls"> 
                                    <select name="item_cate" class="input-normal bui-form-field-select bui-form-field bui-form-field-select-hover bui-form-field-hover bui-form-field-error" aria-disabled="false" aria-pressed="false">
                                        <option value="0">--请选择--</option>
                                        <foreach name="cateList2" item="itemc1">
                                            <option value="{$itemc1.id}">{$itemc1.name}</option>
                                        </foreach>
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品标签：</label>
                                <div class="controls">
                                    <!--<div id="s1">
                                    <input type="hidden" id="hide" value="" name="item_tag">
                                    </div>-->
                                    <foreach name="tagList" item="itemc2">
                                        <input name="item_tag" type="checkbox" value='{$itemc2.id}' >{$itemc2.name}&nbsp;&nbsp;&nbsp;&nbsp;
                                    </foreach>
                                </div>
                            </div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>图片地址：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoDetail_url" name="pictUrl" value="{$item.pictUrl}" />
                                </div>
                            </div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>优惠券地址：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoDetail_url" name="couponLink" value="{$item.couponlink}" />
                                </div>
                            </div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>采集人:</label>
                                <div class="controls">
                                    <input type="text" class="input-span3 taoDetail_url disabled" disabled="disabled" name="username" value="{$username}" />
                                </div>

                            </div>
                            <img class="taoPic" id="main_img" src="{$item.pictUrl}" />
                        </div>
                        <div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>店铺id：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoid" id="sellerId" name="sellerId" value="{$item['sellerId']}" />
                                </div>
                            </div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>商品淘宝id：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoid" id="taoid" name="auctionId" value="{$item['auctionId']}" />
                                </div>
                                <label class="control-label"><s>*</s>商品title：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal" name="title" value="{$item['title']}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商店名称：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoid" name="shopTitle" value="{$item['shopTitle']}" />
                                </div>
                                <div class="control-group">
                                    <label class="control-label"><s>*</s>店铺类型：</label>
                                    <label class="radio " for=""><input class="is_type_1" type="radio" name="userType" value="0" <if condition="$item['userType'] eq 0">checked="true"</if>>淘宝</label>
                                    <label class="radio " for=""><input class="is_type_2" type="radio" name="userType" value="1" <if condition="$item['userType'] eq 1">checked="true"</if>>天猫</label>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品销量：</label>
                                <div class="controls">
                                    <input type="text" class="input-large" name="biz30day" value="{$item['biz30day']}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品原价：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="reservePrice" value="{$item['reservePrice']}" /> 元
                                </div>
                                <label class="control-label"><s>*</s>折扣价（现价）：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="zkPrice" value="{$item['zkPrice']}" /> 元
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品优惠券金额：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPPrice" name="couponAmount" value="{$item['couponAmount']}" /> 元
                                </div>

                                <label class="control-label"><s>*</s>优惠券淘口令：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="couponLinkTaoToken" value="{$item['couponLinkTaoToken']}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>优惠券信息:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="couponInfo" value="{$item['couponInfo']}" />
                                </div>
                                <label class="control-label"><s>*</s>优惠券开始日:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="couponEffectiveStartTime" value="{$item['couponEffectiveStartTime']}" />
                                </div>
                                <label class="control-label"><s>*</s>优惠券结束日:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="couponEffectiveEndTime" value="{$item['couponEffectiveEndTime']}" />
                                </div>
                                <label class="control-label"><s>*</s>剩余时间:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="dayLeft" value="{$item['dayLeft']}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>优惠券总个数：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoNick" name="couponTotalCount" value="{$item['couponTotalCount']}" />
                                </div>
                                <label class="control-label"><s>*</s>优惠券剩余量:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="couponLeftCount" value="{$item['couponLeftCount']}" />
                                </div>
                                <label class="control-label" style="margin-left: 20px;"><s>*</s>优惠券最低金额:</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="couponStartFee" value="{$item['couponStartFee']}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>折扣：</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="rlRate" value="{$item['rlRate']}" />
                                </div>
                                <label class="control-label"><s>*</s>淘客佣金：</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="tkCommFee" value="{$item.tkRate}" />
                                </div>
                                <label class="control-label"><s>*</s>淘客佣金比</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="tkRate" value="{$item.tkRate}" />
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <include file="public:foot" />
        <script type="text/javascript" src="__JS__/select.js"></script>
        <script type="text/javascript">
                            $(function () {
                                //提交保存
                                $("#submit").click(function () {
                                    $.ajax({
                                        cache: false,
                                        type: "POST",
                                        url: "{:U('Goods/goods_save')}",
                                        data: {
                                            good_info: ($('#goods_add').serializeArray())
                                        },
                                        async: false,
                                        success: function (data) {
                                            if (data.status == 1) {
                                                BUI.use('bui/overlay', function (overlay) {
                                                    BUI.Message.Alert(data.content, 'success');
                                                });
                                                setTimeout("location.reload()", 1000); //刷新页面
                                            } else {
                                                BUI.use('bui/overlay', function (overlay) {
                                                    BUI.Message.Alert(data.content, 'error');
                                                });
                                            }
                                        },
                                        error: function (data) {
                                            BUI.use('bui/overlay', function (overlay) {
                                                BUI.Message.Alert('请求出错，请重新提交！', 'error');
                                            });
                                        }
                                    });
                                });

                                // 采集商品信息
                                $("#btnGet").click(function () {
                                    var url = encodeURIComponent($("#url").val()); //特殊字符编码
                                    $.ajax({
                                        cache: false,
                                        type: "GET",
                                        url: "{:U('Goods/goods_get_pub_info')}",
                                        data: {
                                            'url': url
                                        }, //要发送的的数据
                                        async: false,
                                        success: function (data) {
                                            if (data.status == 1) {
                                                //弹窗提示
                                                BUI.use('bui/overlay', function (overlay) {
                                                    BUI.Message.Alert(data.content, function () {
                                                        this.close();
                                                    }, 'success');
                                                });
                                                //填写表格
                                                $("input[name='auctionUrl']").val(data.item_info.auctionUrl); //淘宝链接
                                                $("#main_img").attr("src", data.item_info.pictUrl); //主图地址
                                                $("input[name='pictUrl']").val(data.item_info.pictUrl); //主图地址
                                                $("input[name='auctionId']").val(data.item_info.auctionId); //淘宝商品id
                                                $("input[name='shopTitle']").val(data.item_info.shopTitle); //商店名称
                                                $("input[name='title']").val(data.item_info.title); //商品title
                                                $("input[name='reservePrice']").val(data.item_info.reservePrice); //商品原价
                                                $("input[name='couponAmount']").val(data.item_info.couponAmount); //商品优惠券价格
                                                $("input[name='couponLink']").val(data.item_info.couponLink); //优惠券链接 couponShortLink
                                                $("input[name='couponShortLink']").val(data.item_info.couponLink); //优惠券链接 
                                                $("input[name='couponLinkTaoToken']").val(data.item_info.couponLinkTaoToken); //优惠券淘口令
                                                $("input[name='couponTotalCount']").val(data.item_info.couponTotalCount); //优惠券总个数
                                                $("input[name='couponLeftCount']").val(data.item_info.couponLeftCount); //优惠券剩余数量
                                                $("input[name='couponStartFee']").val(data.item_info.couponStartFee); //优惠券使用最低金额:
                                                $("input[name='couponInfo']").val(data.item_info.couponInfo); //优惠券信息
                                                $("input[name='couponEffectiveStartTime']").val(data.item_info.couponEffectiveStartTime); //优惠券开始日
                                                $("input[name='couponEffectiveEndTime']").val(data.item_info.couponEffectiveEndTime); //优惠券结束日
                                                $("input[name='dayLeft']").val(data.item_info.dayLeft); //剩余时间
                                                $("input[name='tkCommFee']").val(data.item_info.tkCommFee); //淘客佣金
                                                $("input[name='tkRate']").val(data.item_info.tkRate); //淘客佣金比
                                                $("input[name='biz30day']").val(data.item_info.biz30day); //商品销量
                                                $("input[name='rlRate']").val(data.item_info.rlRate); //折扣
                                                $("input[name='sellerId']").val(data.item_info.sellerId); //卖家ID
                                                $("input[name='zkPrice']").val(data.item_info.zkPrice); //折扣价
                                                if (data.item_info.userType == 0) {
                                                    $(".is_type_1")[0].checked = true;
                                                } else {
                                                    $(".is_type_2")[0].checked = true;
                                                }
                                            } else {
                                                BUI.use('bui/overlay', function (overlay) {
                                                    BUI.Message.Alert(data.content, 'error');
                                                });
                                            }
                                        },
                                        error: function (data) {
                                            BUI.use('bui/overlay', function (overlay) {
                                                BUI.Message.Alert('请求出错，请重新提交！', 'error');
                                            });
                                        }
                                    });
                                });
                            });
        </script>
        <script type="text/javascript">
            BUI.use(['bui/tab', 'bui/mask', 'select'], function (Tab, Select) {
                var tab = new Tab.TabPanel({
                    srcNode: '#tab',
                    elCls: 'nav-tabs',
                    panelContainer: '#panel', //如果不指定容器的父元素，会自动生成
                    // selectedEvent : 'mouseenter',//默认为click,可以更改事件
                    autoRender: true,
                    children: [{
                            title: '商品地址',
                            value: '1',
                            selected: true
                        }, {
                            title: '商品信息',
                            value: '2'
                        }]
                });

                // var items=[
                // 	<foreach name="tagList" item="item" key='k'>
                // 			{
                // 				text:"{$item.name}",value:"{$item.id}"
                // 			},

                // 	</foreach>
                // 	{}
                // ];
                // items=items.splice(items.length-1,1);
                // var select = new Select.Combox({  
                // 	render:'#s1',
                // 	showTag:true,
                // 	width : 500,
                // 	elCls : 'bui-tag-follow',
                // 	valueField : '#hide',//显示tag的Combox必须存在valueField
                // 	items:items
                // });
                // select.render()

            });
        </script>
    </body>

</html>