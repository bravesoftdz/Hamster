<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

    <head>
        <include file="public:header" />
        <link href="__CSS__/page-min.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.config.js"></script>
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/ueditor.all.min.js"></script>
        <script type="text/javascript" charset="utf-8" src="__STATIC__/ueditor/lang/zh-cn/zh-cn.js"></script>

    </head>

    <body>
        <div class="container">
            <div class="clear">
                <button class="button button-default" onclick="javascript :history.back(-1)">返回</button>
                <button type="button" id="submit" class="button button-primary">更新商品</button>
            </div>
            <br/>
            <div class="row">
                <div id="tab"></div>
                <form action="{:u('Goods/goods_update')}" class="form-horizontal" method="post" id="goods_update">
                    <input type="hidden" name="id" value="{$item['id']}" />
                    <div id="panel" class="">
                        <div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>淘宝商品URL：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoid" name="url" id="url" value="{$item.url}" />
                                    <span class="button button-success get_item" id="btnGet">采集商品信息</span>
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>商品淘宝id：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoPic_url" name="taoid" value="{$item.taoid}" />
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品分类：</label>
                                <div class="controls">
                                    <select name="cate_id" class="input-normal bui-form-field-select bui-form-field bui-form-field-select-hover bui-form-field-hover bui-form-field-error" aria-disabled="false" aria-pressed="false">
                                        <option value="0">--请选择--</option>
                                        <foreach name="cateList" item="cate">
                                            <if condition="$cate.id eq $item['cate_id']">
                                                <option value="{$cate.id}" selected="selected">{$cate.name}</option>
                                                <else />
                                                <option value="{$cate.id}">{$cate.name}</option>
                                            </if>
                                        </foreach>
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品标题：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoTitle" name="title" value="{$item.title}" />
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label"><s>*</s>商品价格：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="old_price" value="{$item.old_price}" /> 元
                                </div>
                                <label class="control-label"><s>*</s>折扣价：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPPrice" name="price" value="{$item.price}" /> 元
                                </div>
                                <label class="control-label"><s>*</s>兑换所需积分：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="mb" value="{$item.mb}" /> 米币
                                </div>
                                <label class="control-label"><s>*</s>可兑换数量：</label>
                                <div class="controls">
                                    <input type="text" class="span2 taoPrice" name="exc_num" value="{$item.exc_num}" /> 件
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>商家旺旺：</label>
                                <div class="controls">
                                    <input type="text" class="input-normal taoNick" name="wangwang" value="{$item.wangwang}">
                                </div>
                                <label class="control-label"><s>*</s>30天内交易量：</label>
                                <div class="controls">
                                    <input type="text" class="span2 buy_num" name="buy_num" value="{$item.buy_num}" /> 件
                                </div>
                            </div>

                            <div class="control-group">
                                <label class="control-label"><s>*</s>店铺类型：</label>
                                <label class="radio " for=""><input class="is_type_1" type="radio" name="type" value="1" <if condition="$item['type'] eq 1">checked="true"</if>>集市</label>
                                <label class="radio " for=""><input class="is_type_2" type="radio" name="type" value="2" <if condition="$item['type'] eq 2">checked="true"</if>>天猫</label>
                            </div>

                            <div class="control-group">
                                <label class="control-label">促销信息：</label>
                                <label class="checkbox " for=""><input class="baoyou" type="checkbox" name="baoyou" value="1" <if condition="$item['baoyou'] eq 1">checked="true"</if>>包邮</label>
                                <label class="checkbox " for=""><input class="zhekou" type="checkbox" name="zhekou" value="1" <if condition="$item['zhekou'] eq 1">checked="true"</if>>折扣</label>
                                <label class="checkbox " for=""><input class="has_discount" type="checkbox" name="vip" value="1" <if condition="$item['vip'] eq 1">checked="true"</if>>有VIP价</label>
                            </div>
                            <div class="control-group">
                                <label class="control-label"><s>*</s>是否展示：</label>
                                <label class="radio " for=""><input class="status_1" type="radio" name="status"  value="1" <if condition="$item['status'] eq 1">checked="true"</if>>展示</label>
                                <label class="radio " for=""><input class="status_2" type="radio" name="status"  value="2" <if condition="$item['status'] eq 2">checked="true"</if>>不展示</label>
                            </div>
                            <div class="control-group">
                                <label class="control-label">备注：</label>
                                <input type="text" class="input-large taoPic_url" name="remark" value="{$item.remark}" />
                            </div>
                        </div>
                        <div>
                            <div class="control-group">
                                <script id="editor" name="intro" type="text/plain">{$item.intro}</script>
                                <!-- 实例化编辑器 -->
                                <script type="text/javascript">
                                    var ue = UE.getEditor('editor', {
                                        initialFrameHeight: 350,
                                        autoHeightEnabled: true,
                                        autoFloatEnabled: true
                                    });
                                </script>
                            </div>
                        </div>
                        <div>
                            <div class="control-group" style="margin-top: 20px;">
                                <label class="control-label"><s>*</s>主图地址：</label>
                                <div class="controls">
                                    <input type="text" class="input-large taoDetail_url" name="img" value="{$item.img}" />
                                </div>
                            </div>
                            <img class="taoPic" id="main_img" src="{$item.img}" />
                        </div>
                    </div>

                </form>
            </div>
        </div>
        <include file="public:foot" />
        <script type="text/javascript">
            alert('a')
            $(function () {
                //ajax保存修改
                $("#submit").click(function () {
                    $.ajax({
                        cache: false,
                        type: "POST",
                        url: "{:U('Goods/goods_update')}",
                        data: $('#goods_update').serialize(), //要发送的是ajaxFrm表单中的数据
                        async: false,
                        success: function (data) {
                            if (data.status == 1) {
                                BUI.use('bui/overlay', function (overlay) {
                                    BUI.Message.Alert(data.content, 'success');
                                });
                                //javascript :history.back(-1);
                                setTimeout("history.back(-1)", 1000); //刷新页面
                            } else {
                                BUI.use('bui/overlay', function (overlay) {
                                    BUI.Message.Alert(data.content, 'error');
                                });
                            }
                        },
                        error: function (data) {
                            BUI.use('bui/overlay', function (overlay) {
                                BUI.Message.Alert('请求出错，请重新提交！', 'error');
                            });
                        }
                    });
                });
                //一键获取
                $("#btnGet").click(function () {
                    var url = encodeURIComponent($("#url").val()); //特殊字符编码
                    $.ajax({
                        cache: false,
                        type: "GET",
                        url: "{:U('Goods/goods_info_get')}",
                        data: {
                            'url': url
                        }, //要发送的的数据
                        async: false,
                        success: function (data) {
                            if (data.status == 1) {
                                //填写表格                            
                                $("input[name='url']").val(data.item_info.url);
                                $("#main_img").attr("src", data.item_info.img + '_320x320.jpg');
                                $("input[name='taoid']").val(data.item_info.taoid);
                                $("input[name='title']").val(data.item_info.title);
                                $("input[name='img']").val(data.item_info.img);
                                $("input[name='old_price']").val(data.item_info.price); //商品价格
                                $("input[name='price']").val(data.item_info.discount_price); //商品的折扣价
                                $("input[name='mb']").val(data.item_info.mb); //兑换所需积分
                                $("input[name='buy_num']").val(data.item_info.volume); //30天内交易量
                                $("input[name='wangwang']").val(data.item_info.wangwang);
                                if (data.item_info.type == 1) {
                                    $(".is_type_1")[0].checked = true;
                                } else {
                                    $(".is_type_2")[0].checked = true;
                                }
                                //弹窗提示
                                BUI.use('bui/overlay', function (overlay) {
                                    BUI.Message.Alert(data.content, function () {
                                        this.close();
                                    }, 'success');
                                });
                                //                        setTimeout("location.reload()",1000); //刷新页面
                            } else {
                                BUI.use('bui/overlay', function (overlay) {
                                    BUI.Message.Alert(data.content, 'error');
                                });
                            }
                        },
                        error: function (data) {
                            BUI.use('bui/overlay', function (overlay) {
                                BUI.Message.Alert('请求出错，请重新提交！', 'error');
                            });
                        }
                    });
                });
            });
        </script>
        <script type="text/javascript">
            BUI.use(['bui/tab', 'bui/mask'], function (Tab) {
                var tab = new Tab.TabPanel({
                    srcNode: '#tab',
                    elCls: 'nav-tabs',
                    panelContainer: '#panel', //如果不指定容器的父元素，会自动生成
                    // selectedEvent : 'mouseenter',//默认为click,可以更改事件
                    autoRender: true,
                    children: [{
                            title: '商品地址',
                            value: '1',
                            selected: true
                        }, {
                            title: '商品信息',
                            value: '2'
                        }, {
                            title: '商品详情',
                            value: '3'
                        }, {
                            title: '商品图片',
                            value: '4'
                        }]
                });
            });
        </script>
    </body>

</html>